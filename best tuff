--[[ 
    Player Control GUI + Smooth Orbit + Click TP + Speed + Bomb + Noclip Orbit
    Keybinds:
    E = Teleport to nearest player
    F = Toggle Orbit nearest player
    Left Shift + Click = Click TP
]]

local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Mouse = player:GetMouse()

-- SETTINGS
local currentSpeed = 40
local orbitEnabled = false
local orbitRadius = 10
local orbitSpeed = math.rad(180) -- radians/sec
local orbitAngle = 0
local orbitOldPosition = nil

-- DELETE ALL LAVA PARTS
for _, part in pairs(workspace:GetDescendants()) do
	if part:IsA("BasePart") and part.Name:lower() == "lava" then
		part:Destroy()
	end
end

-- CREATE PART ABOVE LAVA AREA (if needed)
local lava = workspace:FindFirstChild("Arenas")
and workspace.Arenas:FindFirstChild("Arena1")
and workspace.Arenas.Arena1:FindFirstChild("Map")
and workspace.Arenas.Arena1.Map:FindFirstChild("Lava")

if lava then
	local part = Instance.new("Part")
	part.Size = Vector3.new(10,1,10)
	part.Anchored = true
	part.CanCollide = false -- passable
	part.Material = Enum.Material.Neon
	part.Color = Color3.fromRGB(255,0,0)
	part.Position = lava.Position + Vector3.new(0,5,0)
	part.Parent = workspace
end

-- GUI SETUP
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PlayerControlGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 350)
frame.Position = UDim2.new(0.05, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BackgroundTransparency = 0.1
frame.BorderSizePixel = 0
frame.Parent = screenGui
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,30)
title.Position = UDim2.new(0,0,0,0)
title.BackgroundTransparency = 1
title.Text = "Player Controls, look in console for more info"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.Parent = frame

-- MODE LABEL
local modeLabel = Instance.new("TextLabel")
modeLabel.Size = UDim2.new(0.9,0,0,30)
modeLabel.Position = UDim2.new(0.05,0,0.05,0)
modeLabel.BackgroundTransparency = 1
modeLabel.Text = "Mode: None"
modeLabel.TextColor3 = Color3.fromRGB(200,200,255)
modeLabel.Font = Enum.Font.Gotham
modeLabel.TextScaled = true
modeLabel.Parent = frame

-- SPEED TEXTBOX
local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0.9,0,0,30)
speedBox.Position = UDim2.new(0.05,0,0.15,0)
speedBox.PlaceholderText = "Speed (0.3+)"
speedBox.Text = tostring(currentSpeed)
speedBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
speedBox.TextColor3 = Color3.fromRGB(255,255,255)
speedBox.Font = Enum.Font.Gotham
speedBox.TextScaled = true
speedBox.ClearTextOnFocus = false
speedBox.Parent = frame

-- ORBIT RADIUS SLIDER
local radiusLabel = Instance.new("TextLabel")
radiusLabel.Size = UDim2.new(0.9,0,0,25)
radiusLabel.Position = UDim2.new(0.05,0,0.35,0)
radiusLabel.BackgroundTransparency = 1
radiusLabel.Text = "Orbit Radius: "..orbitRadius
radiusLabel.TextColor3 = Color3.fromRGB(255,255,255)
radiusLabel.Font = Enum.Font.Gotham
radiusLabel.TextScaled = true
radiusLabel.Parent = frame

local radiusSlider = Instance.new("TextBox")
radiusSlider.Size = UDim2.new(0.9,0,0,30)
radiusSlider.Position = UDim2.new(0.05,0,0.41,0)
radiusSlider.PlaceholderText = "Enter radius"
radiusSlider.Text = tostring(orbitRadius)
radiusSlider.BackgroundColor3 = Color3.fromRGB(50,50,50)
radiusSlider.TextColor3 = Color3.fromRGB(255,255,255)
radiusSlider.Font = Enum.Font.Gotham
radiusSlider.TextScaled = true
radiusSlider.ClearTextOnFocus = false
radiusSlider.Parent = frame

-- ORBIT SPEED SLIDER
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0.9,0,0,25)
speedLabel.Position = UDim2.new(0.05,0,0.51,0)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Orbit Speed: "..math.deg(orbitSpeed).." deg/sec"
speedLabel.TextColor3 = Color3.fromRGB(255,255,255)
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextScaled = true
speedLabel.Parent = frame

local speedSlider = Instance.new("TextBox")
speedSlider.Size = UDim2.new(0.9,0,0,30)
speedSlider.Position = UDim2.new(0.05,0,0.57,0)
speedSlider.PlaceholderText = "Enter speed in deg/sec"
speedSlider.Text = tostring(math.deg(orbitSpeed))
speedSlider.BackgroundColor3 = Color3.fromRGB(50,50,50)
speedSlider.TextColor3 = Color3.fromRGB(255,255,255)
speedSlider.Font = Enum.Font.Gotham
speedSlider.TextScaled = true
speedSlider.ClearTextOnFocus = false
speedSlider.Parent = frame

-- MODE PRINT
print([[Keybinds:
E = Teleport to nearest player
F = Toggle Orbit nearest player
Left Shift + Click = Click TP
]])

-- FUNCTIONS
local function getNearestPlayer()
	local char = player.Character
	if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
	local root = char.HumanoidRootPart
	local nearest, nearestDist = nil, math.huge
	for _, plr in pairs(game.Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (root.Position - plr.Character.HumanoidRootPart.Position).Magnitude
			if dist < nearestDist then
				nearestDist = dist
				nearest = plr
			end
		end
	end
	return nearest
end

local function teleportNearest()
	local nearest = getNearestPlayer()
	local char = player.Character
	if nearest and char and char:FindFirstChild("HumanoidRootPart") then
		char.HumanoidRootPart.CFrame = CFrame.new(nearest.Character.HumanoidRootPart.Position + Vector3.new(0,2,0))
	end
end


-- CLICK TP
Mouse.Button1Down:Connect(function()
	if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local mousePos = Mouse.Hit.Position
			char.HumanoidRootPart.CFrame = CFrame.new(mousePos + Vector3.new(0,2,0))
		end
	end
end)

-- INPUT HANDLING
UserInputService.InputBegan:Connect(function(input, processed)
	if not processed then
		if input.KeyCode == Enum.KeyCode.E then
			teleportNearest()
		elseif input.KeyCode == Enum.KeyCode.F then
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				if not orbitEnabled then
					orbitOldPosition = char.HumanoidRootPart.Position
					orbitEnabled = true
					-- ENABLE NOCLIP
					for _, part in pairs(char:GetDescendants()) do
						if part:IsA("BasePart") then
							part.CanCollide = false
						end
					end
				else
					orbitEnabled = false
					-- DISABLE NOCLIP
					local root = char:FindFirstChild("HumanoidRootPart")
					for _, part in pairs(char:GetDescendants()) do
						if part:IsA("BasePart") then
							part.CanCollide = true
						end
					end
					if orbitOldPosition and root then
						root.CFrame = CFrame.new(orbitOldPosition + Vector3.new(0,2,0))
						orbitOldPosition = nil
					end
				end
			end
		end
	end
end)

-- UPDATE SPEED & ORBIT SETTINGS
speedBox.FocusLost:Connect(function()
	local val = tonumber(speedBox.Text)
	if val and val >= 0.3 then
		currentSpeed = val
		speedBox.Text = tostring(currentSpeed)
	else
		speedBox.Text = tostring(currentSpeed)
	end
end)

radiusSlider.FocusLost:Connect(function()
	local val = tonumber(radiusSlider.Text)
	if val and val > 0 then
		orbitRadius = val
		radiusLabel.Text = "Orbit Radius: "..orbitRadius
	else
		radiusSlider.Text = tostring(orbitRadius)
	end
end)

speedSlider.FocusLost:Connect(function()
	local val = tonumber(speedSlider.Text)
	if val and val > 0 then
		orbitSpeed = math.rad(val)
		speedLabel.Text = "Orbit Speed: "..val.." deg/sec"
	else
		speedSlider.Text = tostring(math.deg(orbitSpeed))
	end
end)

-- SMOOTH ORBIT + SPEED + PASS THROUGH + NOCLIP
local function startSpeed(character)
	local humanoid = character:WaitForChild("Humanoid")
	local root = character:WaitForChild("HumanoidRootPart")

	RunService.Heartbeat:Connect(function(dt)
		if humanoid and humanoid.Health > 0 then
			-- Walking speed
			if humanoid.MoveDirection.Magnitude > 0 then
				root.CFrame = root.CFrame + humanoid.MoveDirection.Unit * currentSpeed * dt
			end

			-- Smooth orbit
			if orbitEnabled then
				local nearest = getNearestPlayer()
				if nearest and nearest.Character and nearest.Character:FindFirstChild("HumanoidRootPart") then
					orbitAngle = orbitAngle + orbitSpeed * dt
					local targetPos = nearest.Character.HumanoidRootPart.Position
					local orbitX = orbitRadius * math.cos(orbitAngle)
					local orbitZ = orbitRadius * math.sin(orbitAngle)
					local desiredPos = Vector3.new(targetPos.X + orbitX, root.Position.Y, targetPos.Z + orbitZ)

					-- Noclip / pass through
					root.CanCollide = false
					root.CFrame = CFrame.new(root.Position:Lerp(desiredPos, 0.2), targetPos)

					modeLabel.Text = "Mode: Orbiting"
				end
			else
				modeLabel.Text = "Mode: None"
			end
		end
	end)
end

-- RUN ON RESPAWN
if player.Character then
	startSpeed(player.Character)
end
player.CharacterAdded:Connect(startSpeed)

-- CUSTOM HOOK AND RESET (local player only)
local old; old = hookmetamethod(game, "__namecall", function(self, ...)
    if self == game.ReplicatedStorage.Remotes.Replicator.RegisterDied and getnamecallmethod() == "FireServer" then
        return;
    end;
    return old(self, ...)
end)

local reset = Instance.new("BindableEvent")
reset.Event:Connect(function() game.Players.LocalPlayer.Character.Humanoid.Health = 0 end)
game:GetService("StarterGui"):SetCore("ResetButtonCallback", reset)

print("success - orbit noclip enabled")
