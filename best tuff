-- LocalScript → StarterPlayerScripts
-- JToH Class Selector GUI - Classes 10/11/15/17 fully implemented - Omega only Ascension (Jan 2026)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local GuiService = game:GetService("GuiService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Clean up old GUI
if playerGui:FindFirstChild("ClassSelector") then
    playerGui.ClassSelector:Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ClassSelector"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local isMobile = UserInputService.TouchEnabled

-- Device toggle
local function shouldShowGUI()
    if not isMobile then return true end
    return player:GetAttribute("ClassSelector_ShowOnMobile") == true
end

-- Scaling
local function getGuiScale()
    local screenSize = GuiService:GetScreenResolution()
    local baseWidth = 480
    local scale = math.clamp(screenSize.X / baseWidth, 0.65, 1.0)
    return scale
end

-- Draggable
local function makeDraggable(frame)
    local dragging = false
    local dragInput, dragStart, startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    UserInputService.TouchEnded:Connect(function() dragging = false end)
end

-- Teleport
local function tryTeleport(target)
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local part = target
    if not part:IsA("BasePart") then
        part = target:FindFirstChildWhichIsA("BasePart", true) or target
    end

    if part and part:IsA("BasePart") then
        hrp.CFrame = part.CFrame * CFrame.new(0, 5, 0)
        print("Teleported → " .. part:GetFullName())
    else
        warn("No valid BasePart for teleport")
    end
end

-- Popup creator
local function createScrollingPopup(titleText, baseHeight, isMobileVersion)
    local scale = getGuiScale()
    local height = math.floor(baseHeight * scale)
    local sizeMult = isMobileVersion and 1.0 or 0.70
    height = math.floor(height * sizeMult)
    height = math.min(height, GuiService:GetScreenResolution().Y * 0.88)

    local popup = Instance.new("Frame")
    popup.Size = UDim2.new(0.92 * scale * sizeMult, 0, 0, height)
    popup.Position = UDim2.new(0.5, 0, 0.5, 0)
    popup.AnchorPoint = Vector2.new(0.5, 0.5)
    popup.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
    popup.BorderSizePixel = 0
    popup.Parent = screenGui
    makeDraggable(popup)
    Instance.new("UICorner", popup).CornerRadius = UDim.new(0, 14)

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, math.max(50, 54 * scale))
    title.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
    title.BorderSizePixel = 0
    title.Text = titleText
    title.TextColor3 = Color3.new(1,1,1)
    title.Font = Enum.Font.GothamBold
    title.TextSize = math.max(20, 24 * scale)
    title.Parent = popup
    Instance.new("UICorner", title).CornerRadius = UDim.new(0, 14)

    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, -24 * scale, 1, -80 * scale)
    scroll.Position = UDim2.new(0, 12 * scale, 0, 66 * scale)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = isMobileVersion and 14 or 8
    scroll.ScrollBarImageColor3 = Color3.fromRGB(100,100,140)
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y
    scroll.Parent = popup

    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, math.max(10, 14 * scale))
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout.Parent = scroll

    local pad = Instance.new("UIPadding")
    pad.PaddingTop = UDim.new(0, 10 * scale)
    pad.PaddingBottom = UDim.new(0, 16 * scale)
    pad.PaddingLeft = UDim.new(0, 4 * scale)
    pad.PaddingRight = UDim.new(0, 4 * scale)
    pad.Parent = scroll

    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scroll.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 40 * scale)
    end)

    local back = Instance.new("TextButton")
    back.Size = UDim2.new(0.88, 0, 0, math.max(48, 60 * scale))
    back.Position = UDim2.new(0.06, 0, 1, -15 * scale)
    back.AnchorPoint = Vector2.new(0,1)
    back.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    back.Text = "← Back"
    back.TextColor3 = Color3.new(1,1,1)
    back.Font = Enum.Font.GothamSemibold
    back.TextSize = math.max(18, 22 * scale)
    back.Parent = popup
    Instance.new("UICorner", back).CornerRadius = UDim.new(0, 12)

    back.MouseButton1Click:Connect(function() popup:Destroy() end)

    return popup, scroll
end

-- ========================================================================
-- Class 10 Popup - using your earlier paths
-- ========================================================================
local function openClass10Popup()
    local popup, scroll = createScrollingPopup("Class 10 – Floor & Lighting TPs", 520, not isMobile)

    local kit = workspace:FindFirstChild("JToH Kit v5.35")
    local lighting = kit and kit:FindFirstChild("ClientSidedObjects") and kit.ClientSidedObjects:FindFirstChild("LightingChangers")
    local area10 = workspace.Areas and workspace.Areas:FindFirstChild("Class10")

    local tps = {
        {text = "TP to 'the light of day'", target = function()
            return workspace:GetChildren()[90] and workspace:GetChildren()[90]:FindFirstChild("part")
        end},
        {text = "TP to Floor 1", target = function() return lighting and lighting:GetChildren()[9] end},
        {text = "TP to Floor 2", target = function() return lighting and lighting:GetChildren()[10] end},
        {text = "TP to Floor 3", target = function() return lighting and lighting:GetChildren()[11] end},
        {text = "TP to Floor 4", target = function() return lighting and lighting:GetChildren()[12] end},
        {text = "TP to Floor 5 / The Roof", target = function()
            return area10 and area10:GetChildren()[11] and area10:GetChildren()[11]:FindFirstChild("HealingPad")
        end},
    }

    for _, entry in ipairs(tps) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.94, 0, 0, 58)
        btn.BackgroundColor3 = Color3.fromRGB(70, 150, 220)
        btn.Text = entry.text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamSemibold
        btn.TextScaled = true
        btn.Parent = scroll
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

        btn.MouseButton1Click:Connect(function()
            local t = entry.target()
            if t then tryTeleport(t) else warn("Class 10 - missing: " .. entry.text) end
        end)
    end
end

-- ========================================================================
-- Class 11 Popup - using your earlier paths
-- ========================================================================
local function openClass11Popup()
    local popup, scroll = createScrollingPopup("Class 11 – Checkpoints", 340, not isMobile)

    local canister = workspace:FindFirstChild("CanisterMode")

    local tps = {
        {text = "TP to the start of class 11", target = function() return canister and canister:FindFirstChild("Class11") end},
        {text = "TP to the halfway point",     target = function() return canister and canister:GetChildren()[14] end},
        {text = "TP to the end",               target = function() return canister and canister:GetChildren()[36] end},
    }

    for _, entry in ipairs(tps) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.94, 0, 0, 60)
        btn.BackgroundColor3 = Color3.fromRGB(90, 190, 140)
        btn.Text = entry.text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamBold
        btn.TextScaled = true
        btn.Parent = scroll
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

        btn.MouseButton1Click:Connect(function()
            local t = entry.target()
            if t then tryTeleport(t) else warn("Class 11 - missing: " .. entry.text) end
        end)
    end
end

-- ========================================================================
-- Class 15 Popup - using your earlier paths
-- ========================================================================
local function openClass15Popup()
    local popup, scroll = createScrollingPopup("Class 15 – Special TPs", 420, not isMobile)

    local kit = workspace:FindFirstChild("JToH Kit v5.35")
    local objs = kit and kit:FindFirstChild("ClientSidedObjects")

    local actions = {
        {text = "Money Givers",     idx = 64},
        {text = "Portals",          idx = 112},
        {text = "Orbs",             special = "orbs"},
        {text = "Skip to Floor 8",  idx = 28}
    }

    for _, act in ipairs(actions) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.94, 0, 0, 58)
        btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        btn.Text = act.text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamSemibold
        btn.TextScaled = true
        btn.Parent = scroll
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

        btn.MouseButton1Click:Connect(function()
            local target
            if act.idx and objs then
                local ch = objs:GetChildren()
                if #ch >= act.idx then
                    target = ch[act.idx]:FindFirstChild("Destination") or ch[act.idx]
                end
            elseif act.special == "orbs" then
                local cm = workspace:FindFirstChild("CanisterMode")
                target = cm and cm:FindFirstChild("Class15.1")
            end

            if target then
                tryTeleport(target)
            else
                warn("Class 15 - missing: " .. act.text)
            end
        end)
    end
end

-- ========================================================================
-- Class 17 Popup - using your exact paths/indices
-- ========================================================================
local function openClass17Popup()
    local popup, scroll = createScrollingPopup("Class 17 – Floor Teleports", 580, not isMobile)

    local kit = workspace:FindFirstChild("JToH Kit v5.35")
    local areas = workspace:FindFirstChild("Areas")
    local class17 = areas and areas:FindFirstChild("Class17")

    if not class17 then
        local err = Instance.new("TextLabel")
        err.Size = UDim2.new(0.9,0,0,80)
        err.BackgroundTransparency = 1
        err.TextColor3 = Color3.fromRGB(255,80,80)
        err.Text = "ERROR: Class17 folder not found"
        err.TextScaled = true
        err.Parent = scroll
        return
    end

    local tps = {
        {text = "Very Start", target = function()
            local lc = kit and kit:FindFirstChild("ClientSidedObjects") and kit.ClientSidedObjects:FindFirstChild("LightingChangers")
            return lc and lc:GetChildren()[33]
        end},

        {text = "Floor 1", target = function() return class17:GetChildren()[162] end},
        {text = "Floor 2", target = function() return class17:GetChildren()[415] end},
        {text = "Floor 3", target = function() return class17:GetChildren()[842] end},
        {text = "Floor 4", target = function() return class17:GetChildren()[9] and class17:GetChildren()[9]:FindFirstChild("part") end},
        {text = "Floor 5", target = function() return class17:GetChildren()[6] and class17:GetChildren()[6]:FindFirstChild("part") end},
        {text = "Floor 6", target = function() return class17:GetChildren()[1332] end},
        {text = "Floor 7", target = function() return class17:GetChildren()[29] and class17:GetChildren()[29]:FindFirstChild("part") end},
        {text = "Floor 8", target = function() return class17:GetChildren()[30] and class17:GetChildren()[30]:FindFirstChild("part") end},
        {text = "Floor 9", target = function() return class17:GetChildren()[34] and class17:GetChildren()[34]:FindFirstChild("part") end},
        {text = "Floor 10", target = function() return class17:GetChildren()[35] and class17:GetChildren()[35]:FindFirstChild("part") end},
    }

    for _, entry in ipairs(tps) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.92, 0, 0, 58)
        btn.BackgroundColor3 = Color3.fromRGB(90, 140, 200)
        btn.Text = entry.text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamSemibold
        btn.TextScaled = true
        btn.Parent = scroll
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

        btn.MouseButton1Click:Connect(function()
            local t = entry.target()
            if t then 
                tryTeleport(t)
            else
                warn("Class 17 - missing: " .. entry.text)
            end
        end)
    end
end

-- ========================================================================
-- Omega tab - only Ascension remains
-- ========================================================================
local function showOmegaButtons()
    for _, child in ipairs(scroll:GetChildren()) do
        if child:IsA("GuiObject") then child:Destroy() end
    end

    local areas = workspace:FindFirstChild("Areas")
    if not areas then
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1,0,0,60)
        lbl.BackgroundTransparency = 1
        lbl.TextColor3 = Color3.fromRGB(255,100,100)
        lbl.Text = "Areas folder not found"
        lbl.TextScaled = true
        lbl.Parent = scroll
        updateCanvas()
        return
    end

    local function addButton(text, getTarget, color)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, -10 * scale, 0, isMobileVersion and 80 or 70)
        btn.BackgroundColor3 = color or Color3.fromRGB(100, 140, 220)
        btn.Text = text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamBold
        btn.TextScaled = true
        btn.Parent = scroll
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

        btn.MouseButton1Click:Connect(function()
            local t = getTarget()
            if t then 
                tryTeleport(t)
                print("Success: " .. text)
            else 
                warn("Failed: " .. text .. " - target = " .. tostring(t))
            end
        end)
    end

    -- Only Omega Ascension
    addButton("Omega Ascension - TP to omega button", function()
        local c19 = areas:FindFirstChild("Class19")
        local btn = c19 and c19:FindFirstChild("Omega Ascension Button")
        return btn and btn:FindFirstChild("part")
    end, Color3.fromRGB(100, 140, 220))

    addButton("Omega Ascension - TP infront of the button", function()
        local c19 = areas:FindFirstChild("Class19")
        local stand = c19 and c19:FindFirstChild("Stand")
        return stand and stand:GetChildren()[32]
    end, Color3.fromRGB(100, 140, 220))

    updateCanvas()
end

-- Main GUI
local function createMainGUI(widthScale, heightScale, isPC)
    local scale = getGuiScale()
    local isMobileVersion = not isPC

    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(widthScale, 0, heightScale, 0)
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = true  -- force visible
    mainFrame.Parent = screenGui
    if isPC then makeDraggable(mainFrame) end
    Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 12)

    print("Main GUI frame created - visible:", mainFrame.Visible)

    -- Device toggle button
    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 160, 0, 38)
    toggle.Position = UDim2.new(1, -10, 0, 10)
    toggle.AnchorPoint = Vector2.new(1, 0)
    toggle.BackgroundColor3 = shouldShowGUI() and Color3.fromRGB(80, 200, 100) or Color3.fromRGB(200, 80, 80)
    toggle.Text = isMobile and ("Mobile GUI: " .. (shouldShowGUI() and "ON" or "OFF")) or "PC Mode"
    toggle.TextColor3 = Color3.new(1,1,1)
    toggle.Font = Enum.Font.GothamBold
    toggle.TextSize = 14
    toggle.Parent = mainFrame
    Instance.new("UICorner", toggle).CornerRadius = UDim.new(0, 19)

    toggle.MouseButton1Click:Connect(function()
        if not isMobile then return end
        local cur = player:GetAttribute("ClassSelector_ShowOnMobile") == true
        player:SetAttribute("ClassSelector_ShowOnMobile", not cur)
        toggle.BackgroundColor3 = not cur and Color3.fromRGB(80, 200, 100) or Color3.fromRGB(200, 80, 80)
        toggle.Text = "Mobile GUI: " .. (not cur and "ON" or "OFF")
        mainFrame.Visible = not cur
    end)

    -- Tab bar
    local tabBar = Instance.new("Frame")
    tabBar.Size = UDim2.new(1, 0, 0, isMobileVersion and 70 or 50)
    tabBar.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    tabBar.BorderSizePixel = 0
    tabBar.Parent = mainFrame

    local tabLayout = Instance.new("UIListLayout")
    tabLayout.FillDirection = Enum.FillDirection.Horizontal
    tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    tabLayout.Padding = UDim.new(0, 12 * scale)
    tabLayout.Parent = tabBar

    local function createTab(name, active)
        local tab = Instance.new("TextButton")
        tab.Size = UDim2.new(0, math.min(140 * scale, 120), 0, 38 * scale)
        tab.BackgroundColor3 = active and Color3.fromRGB(70, 70, 255) or Color3.fromRGB(55, 55, 55)
        tab.Text = name
        tab.TextColor3 = Color3.new(1,1,1)
        tab.Font = Enum.Font.GothamBold
        tab.TextSize = math.max(14, 16 * scale)
        tab.TextScaled = true
        tab.Parent = tabBar
        Instance.new("UICorner", tab).CornerRadius = UDim.new(0, 10)
        return tab
    end

    local classesTab = createTab("Classes", true)
    local omegaTab   = createTab("Omega", false)

    local content = Instance.new("Frame")
    content.Size = UDim2.new(1, -20 * scale, 1, - (tabBar.Size.Y.Offset + 20 * scale))
    content.Position = UDim2.new(0, 10 * scale, 0, tabBar.Size.Y.Offset + 10 * scale)
    content.BackgroundTransparency = 1
    content.Parent = mainFrame

    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, 0, 1, 0)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = isMobileVersion and 14 or 8
    scroll.ScrollBarImageColor3 = Color3.fromRGB(90,90,120)
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y
    scroll.Parent = content

    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, isMobileVersion and 14 or 10)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = scroll

    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 12 * scale)
    padding.PaddingBottom = UDim.new(0, 20 * scale)
    padding.PaddingLeft = UDim.new(0, 8 * scale)
    padding.PaddingRight = UDim.new(0, 8 * scale)
    padding.Parent = scroll

    local function updateCanvas()
        scroll.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 40 * scale)
    end
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

    local function showClasses()
        print("Loading Classes tab")
        for _, child in ipairs(scroll:GetChildren()) do
            if child:IsA("GuiObject") then child:Destroy() end
        end

        for i = 1, 18 do
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, -10 * scale, 0, isMobileVersion and 80 or 65)
            btn.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            btn.Text = "Class " .. i
            btn.TextColor3 = Color3.new(1,1,1)
            btn.TextScaled = true
            btn.Font = Enum.Font.GothamSemibold
            btn.Parent = scroll
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

            btn.MouseButton1Click:Connect(function()
                print("Clicked Class " .. i)
                if i == 10 then openClass10Popup()
                elseif i == 11 then openClass11Popup()
                elseif i == 15 then openClass15Popup()
                elseif i == 17 then openClass17Popup()
                end
            end)

            btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(80,80,100) end)
            btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(55,55,70) end)
        end

        updateCanvas()
    end

    local function showOmegaButtons()
        print("Loading Omega tab")
        for _, child in ipairs(scroll:GetChildren()) do
            if child:IsA("GuiObject") then child:Destroy() end
        end

        local areas = workspace:FindFirstChild("Areas")
        if not areas then
            local lbl = Instance.new("TextLabel")
            lbl.Size = UDim2.new(1,0,0,60)
            lbl.BackgroundTransparency = 1
            lbl.TextColor3 = Color3.fromRGB(255,100,100)
            lbl.Text = "Areas not found"
            lbl.TextScaled = true
            lbl.Parent = scroll
            updateCanvas()
            return
        end

        local function addButton(text, getTarget, color)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, -10 * scale, 0, isMobileVersion and 80 or 70)
            btn.BackgroundColor3 = color or Color3.fromRGB(100, 140, 220)
            btn.Text = text
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Font = Enum.Font.GothamBold
            btn.TextScaled = true
            btn.Parent = scroll
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

            btn.MouseButton1Click:Connect(function()
                local t = getTarget()
                if t then 
                    tryTeleport(t)
                    print("Success: " .. text)
                else 
                    warn("Failed: " .. text .. " - target = " .. tostring(t))
                end
            end)
        end

        -- Only Omega Ascension
        addButton("Omega Ascension - TP to omega button", function()
            local c19 = areas:FindFirstChild("Class19")
            local btn = c19 and c19:FindFirstChild("Omega Ascension Button")
            return btn and btn:FindFirstChild("part")
        end, Color3.fromRGB(100, 140, 220))

        addButton("Omega Ascension - TP infront of the button", function()
            local c19 = areas:FindFirstChild("Class19")
            local stand = c19 and c19:FindFirstChild("Stand")
            return stand and stand:GetChildren()[32]
        end, Color3.fromRGB(100, 140, 220))

        updateCanvas()
    end

    local currentTab = "classes"

    local function switchTab(tabName)
        print("Switching to tab: " .. tabName)
        if tabName == currentTab then return end

        classesTab.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
        omegaTab.BackgroundColor3   = Color3.fromRGB(55, 55, 55)

        if tabName == "classes" then
            classesTab.BackgroundColor3 = Color3.fromRGB(70, 70, 255)
            showClasses()
        elseif tabName == "omega" then
            omegaTab.BackgroundColor3 = Color3.fromRGB(70, 70, 255)
            showOmegaButtons()
        end

        currentTab = tabName
    end

    classesTab.MouseButton1Click:Connect(function() switchTab("classes") end)
    omegaTab.MouseButton1Click:Connect(function() switchTab("omega") end)

    -- Force initial load
    showClasses()
    print("Initial Classes tab loaded")
end

-- Version selector + launch
if shouldShowGUI() then
    local selector = Instance.new("Frame")
    selector.Size = UDim2.new(0, 300, 0, 180)
    selector.Position = UDim2.new(0.5, -150, 0.5, -90)
    selector.AnchorPoint = Vector2.new(0.5, 0.5)
    selector.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    selector.BorderSizePixel = 0
    selector.Parent = screenGui
    Instance.new("UICorner", selector).CornerRadius = UDim.new(0, 16)
    makeDraggable(selector)

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 60)
    title.BackgroundTransparency = 1
    title.Text = "Choose Version"
    title.TextColor3 = Color3.new(1,1,1)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 24
    title.Parent = selector

    local pcBtn = Instance.new("TextButton")
    pcBtn.Size = UDim2.new(0.88, 0, 0, 55)
    pcBtn.Position = UDim2.new(0.06, 0, 0, 75)
    pcBtn.BackgroundColor3 = Color3.fromRGB(70, 140, 220)
    pcBtn.Text = "PC (Small)"
    pcBtn.TextColor3 = Color3.new(1,1,1)
    pcBtn.Font = Enum.Font.GothamBold
    pcBtn.TextSize = 18
    pcBtn.Parent = selector
    Instance.new("UICorner", pcBtn).CornerRadius = UDim.new(0, 12)

    local mobileBtn = Instance.new("TextButton")
    mobileBtn.Size = UDim2.new(0.88, 0, 0, 55)
    mobileBtn.Position = UDim2.new(0.06, 0, 0, 140)
    mobileBtn.BackgroundColor3 = Color3.fromRGB(90, 190, 120)
    mobileBtn.Text = "Mobile (Full Screen)"
    mobileBtn.TextColor3 = Color3.new(1,1,1)
    mobileBtn.Font = Enum.Font.GothamBold
    mobileBtn.TextSize = 18
    mobileBtn.Parent = selector
    Instance.new("UICorner", mobileBtn).CornerRadius = UDim.new(0, 12)

    pcBtn.MouseButton1Click:Connect(function()
        selector:Destroy()
        createMainGUI(0.38, 0.58, true)
    end)

    mobileBtn.MouseButton1Click:Connect(function()
        selector:Destroy()
        createMainGUI(0.96, 0.94, false)
    end)

    if isMobile then
        task.wait(0.8)
        mobileBtn:Activate()
    end
else
    print("GUI hidden on mobile device")
end

print("Class Selector loaded - check F9 console for debug messages")
